{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ali Bahrami</title>
    <link rel="stylesheet" href="{% static 'css/portfolio-style.css' %}" />
    <link rel="icon" href="{% static 'images/programming.png' %}" type="image/png" />
    {% block extra_css %}{% endblock %}
    <!-- استفاده از CDN جایگزین برای feather-icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
      // Fallback در صورت عدم لود شدن feather از CDN اصلی
      (function() {
        function loadFeatherFallback() {
          if (typeof feather === 'undefined') {
            console.warn('Feather icons از CDN لود نشد. تلاش برای استفاده از CDN جایگزین...');
            var script = document.createElement('script');
            script.src = 'https://unpkg.com/feather-icons';
            script.onerror = function() {
              console.warn('Feather icons از هیچ CDN لود نشد. آیکون‌ها ممکن است نمایش داده نشوند.');
            };
            script.onload = function() {
              if (typeof feather !== 'undefined') {
                feather.replace();
              }
            };
            document.head.appendChild(script);
          }
        }
        
        // بررسی بعد از لود شدن صفحه
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadFeatherFallback, 500);
          });
        } else {
          setTimeout(loadFeatherFallback, 500);
        }
      })();
    </script>
  </head>

  <body class="dark-theme">
    {% block header %}
      {% if user.is_authenticated %}
        {% if user.profile %}
          <portfolio-header
            data-is-auth="true"
            data-avatar="{% if user.profile.avatar %}{{ user.profile.avatar.url }}{% endif %}"
            data-profile-url="{% url 'home:profile' %}"
            data-variant="simple"
            data-home-url="{% url 'home:home' %}"
            data-projects-url="{% url 'projects:projects_list' %}"
            data-blog-url="{% url 'blog:blog_home' %}"
            data-logo-url="{% url 'home:home' %}"
          ></portfolio-header>
        {% else %}
          <portfolio-header
            data-is-auth="true"
            data-variant="simple"
            data-home-url="{% url 'home:home' %}"
            data-projects-url="{% url 'projects:projects_list' %}"
            data-blog-url="{% url 'blog:blog_home' %}"
            data-logo-url="{% url 'home:home' %}"
          ></portfolio-header>
        {% endif %}
      {% else %}
        <portfolio-header
          data-is-auth="false"
          data-variant="simple"
          data-home-url="{% url 'home:home' %}"
          data-projects-url="{% url 'projects:projects_list' %}"
          data-blog-url="{% url 'blog:blog_home' %}"
          data-logo-url="{% url 'home:home' %}"
        ></portfolio-header>
      {% endif %}
    {% endblock %}

    {% block content %} {% endblock %}
    <portfolio-footer></portfolio-footer>
    <script src="{% static 'js/header.js'%}"></script>
    <script src="{% static 'js/footer.js'%}"></script>
    <script src="{% static 'js/portfolio-script.js'%}"></script>
    <script>
      // صبر کردن تا feather لود شود
      function initFeather() {
        if (typeof feather !== 'undefined') {
          feather.replace();
        } else {
          // اگر feather هنوز لود نشده، دوباره تلاش کن
          setTimeout(initFeather, 100);
        }
      }
      initFeather();
    </script>
  </body>
</html>
