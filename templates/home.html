{% extends 'base.html' %} {% block content %}

<main>
  <!-- Home Section -->
  <section id="home" class="hero-section">
    <div class="hero-content">
      <div class="profile-image-container">
        <img
          src="{{ content.hero.profile_image }}"
          alt="Profile Picture"
          class="profile-image"
        />
      </div>
      <h1 class="hero-title">{{ content.hero.title }}</h1>
      <div class="hero-subtitle">
        {% for role in content.hero.roles %}
        <span>{{ role }}</span>
        {% if not forloop.last %}
        <span class="separator">|</span>
        {% endif %} {% endfor %}
      </div>
      <div class="hero-buttons">
        {% for button in content.hero.buttons %}
        <a href="{{ button.href }}" class="btn btn-{{ button.variant }}"
          >{{ button.label }}</a
        >
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- About / Biography Section -->
  <section id="about" class="section">
    <div class="container">
      <h2 class="section-title">{{ content.about.title }}</h2>
      <div class="about-content">
        <div class="about-text">
          {% for paragraph in content.about.paragraphs %}
          <p>{{ paragraph }}</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

  <!-- Education Section -->
  <section id="education" class="section">
    <div class="container">
      <h2 class="section-title">{{ content.education.title }}</h2>
      <div class="education-timeline">
        {% for item in content.education.items %}
        <div class="education-item">
          <div class="education-icon">
            <i data-feather="{{ item.icon }}"></i>
          </div>
          <div class="education-content">
            <h3>{{ item.title }}</h3>
            <p class="education-institution">{{ item.institution }}</p>
            <p class="education-period">{{ item.period }}</p>
            <p class="education-description">{{ item.description }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Languages Section -->
  <section id="languages" class="section">
    <div class="container">
      <h2 class="section-title">{{ content.languages.title }}</h2>
      <div class="languages-grid">
        {% for language in content.languages.items %}
        <div class="language-item" data-language-index="{{ forloop.counter0 }}" data-writing="{{ language.writing }}" data-speaking="{{ language.speaking }}" data-listening="{{ language.listening }}">
          <div class="language-header">
            <div class="language-name">
              <i data-feather="globe"></i>
              <span>{{ language.name }}</span>
            </div>
            <div class="language-level">
              <span class="level-text">{{ language.level_text }}</span>
              <div class="level-bar">
                <div
                  class="level-fill"
                  style="width: {{ language.proficiency }}%"
                ></div>
              </div>
            </div>
            <div class="language-toggle">
              <i data-feather="chevron-down" class="toggle-icon"></i>
            </div>
          </div>
          <div class="language-details">
            <div class="language-skill">
              <div class="skill-header">
                <span class="skill-label">
                  <i data-feather="edit-3"></i>
                  نوشتن (Writing)
                </span>
                <span class="skill-percentage">{{ language.writing }}%</span>
              </div>
              <div class="skill-bar">
                <div class="skill-fill" data-width="{{ language.writing }}" style="width: 0%"></div>
              </div>
            </div>
            <div class="language-skill">
              <div class="skill-header">
                <span class="skill-label">
                  <i data-feather="mic"></i>
                  صحبت کردن (Speaking)
                </span>
                <span class="skill-percentage">{{ language.speaking }}%</span>
              </div>
              <div class="skill-bar">
                <div class="skill-fill" data-width="{{ language.speaking }}" style="width: 0%"></div>
              </div>
            </div>
            <div class="language-skill">
              <div class="skill-header">
                <span class="skill-label">
                  <i data-feather="headphones"></i>
                  شنیدن (Listening)
                </span>
                <span class="skill-percentage">{{ language.listening }}%</span>
              </div>
              <div class="skill-bar">
                <div class="skill-fill" data-width="{{ language.listening }}" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Skills Section -->
  <section id="skills" class="section">
    <div class="container">
      <h2 class="section-title">{{ content.skills.title }}</h2>
      <div class="skills-grid">
        {% for skill in content.skills.items %}
        <div class="skill-card">
          <i data-feather="{{ skill.icon }}"></i>
          <h3>{{ skill.title }}</h3>
          <p>{{ skill.description }}</p>
          <div class="skill-tags">
            {% for tag in skill.tags %}
            <span>{{ tag }}</span>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="section">
    <div class="container">
      <h2 class="section-title">پروژه ها</h2>
      <div class="projects-grid">
        {% for project in projects %}
        <div class="project-card">
          <div class="project-image">
            {% if project.image %}
            <img src="{{ project.image.url }}" alt="{{ project.title }}" />
            {% else %}
            <div class="project-image-placeholder">
              <i data-feather="image"></i>
            </div>
            {% endif %}
            {% if project.featured %}
            <div class="project-featured">
              <i data-feather="star"></i>
              <span>ویژه</span>
            </div>
            {% endif %}
            <div class="project-status project-status-{{ project.status }}">
              <i data-feather="{% if project.status == 'completed' %}check-circle{% elif project.status == 'in_progress' %}clock{% else %}pause-circle{% endif %}"></i>
              <span>{{ project.get_status_display }}</span>
            </div>
          </div>
          <div class="project-content">
            <h3>{{ project.title }}</h3>
            <p>{{ project.description }}</p>
            <div class="project-tags">
              {% for cat in project.category.all %}
              <span>{{ cat.name }}</span>
              {% endfor %}
            </div>
            <div class="project-links">
              {% if project.website_url %}
              <a href="{{ project.website_url }}" class="project-link project-link-demo" target="_blank" rel="noopener noreferrer">
                مشاهده وب‌سایت
                <i data-feather="arrow-left"></i>
              </a>
              {% endif %}
              {% if project.github_url %}
              <a href="{{ project.github_url }}" class="project-link project-link-github" target="_blank" rel="noopener noreferrer">
                GitHub
                <i data-feather="github"></i>
              </a>
              {% endif %}
              {% if project.demo_url %}
              <a href="{{ project.demo_url }}" class="project-link project-link-demo" target="_blank" rel="noopener noreferrer">
                دمو
                <i data-feather="external-link"></i>
              </a>
              {% endif %}
            </div>
          </div>
        </div>
        {% empty %}
        <p style="text-align: center; grid-column: 1 / -1; padding: 2rem; color: var(--text-secondary-color);">هیچ پروژه‌ای یافت نشد.</p>
        {% endfor %}
      </div>
      <div class="projects-view-all">
        <a href="{% url 'projects:projects_list' %}" class="view-all-link">
          <span>مشاهده همه پروژه‌ها</span>
          <i data-feather="arrow-left"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="section">
    <div class="container">
      <h2 class="section-title">{{ content.contact.title }}</h2>
      <div class="contact-content">
        <div class="contact-info">
          <h3>{{ content.contact.intro_title }}</h3>
          <p>{{ content.contact.intro_text }}</p>
          <div class="contact-details">
            {% for detail in content.contact.details %}
            <div class="contact-item">
              <i data-feather="{{ detail.icon }}"></i>
              <div>
                <strong>{{ detail.label }}</strong>
                <span>{{ detail.value }}</span>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        <form class="contact-form" id="contactForm" method="POST" action="{% url 'home:save_contact' %}">
          {% csrf_token %}

          
          {% for field in content.contact.form.fields %}
          <div class="form-group">
            <label for="{{ field.id }}">{{ field.label }}</label>

            {% if field.type == 'textarea' %}
            <textarea
              id="{{ field.id }}"
              name="{{ field.id }}"
              required
            ></textarea>
            {% else %}
            <input
              type="{{ field.type }}"
              id="{{ field.id }}"
              name="{{ field.id }}"
              required
            />
            {% endif %}
          </div>
          {% endfor %}

          <button type="submit" class="btn btn-primary">
            {{ content.contact.form.submit_label }}
          </button>
        </form>
      </div>
    </div>
  </section>
</main>

<script>
  (function() {
    'use strict';
    
    function initLanguageCards() {
      const languageItems = document.querySelectorAll('.language-item');
      
      if (languageItems.length === 0) {
        return;
      }
      
      // اضافه کردن event listener به هر language-header
      languageItems.forEach((item) => {
        const header = item.querySelector('.language-header');
        if (!header) {
          return;
        }
        
        // اضافه کردن cursor pointer
        header.style.cursor = 'pointer';
        
        // خواندن مقادیر از data attributes
        const writing = item.getAttribute('data-writing') || '0';
        const speaking = item.getAttribute('data-speaking') || '0';
        const listening = item.getAttribute('data-listening') || '0';
        
        header.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const isCurrentlyExpanded = item.classList.contains('expanded');
          
          // بستن همه آیتم‌ها
          languageItems.forEach((otherItem) => {
            if (otherItem !== item) {
              otherItem.classList.remove('expanded');
            }
          });
          
          // اگر آیتم کلیک شده باز نبود، آن را باز کن
          if (!isCurrentlyExpanded) {
            item.classList.add('expanded');
            
            // انیمیشن skill bars بعد از باز شدن
            setTimeout(function() {
              const skillFills = item.querySelectorAll('.skill-fill');
              
              skillFills.forEach(function(fill, fillIndex) {
                let widthValue;
                // خواندن از data-width یا از data attributes
                widthValue = fill.getAttribute('data-width');
                if (!widthValue) {
                  // اگر data-width نبود، از data attributes item بخوان
                  if (fillIndex === 0) widthValue = writing;
                  else if (fillIndex === 1) widthValue = speaking;
                  else if (fillIndex === 2) widthValue = listening;
                }
                
                if (widthValue) {
                  const width = widthValue + '%';
                  fill.style.width = '0%';
                  // Force reflow
                  fill.offsetHeight;
                  setTimeout(function() {
                    fill.style.width = width;
                  }, 10);
                }
              });
            }, 300);
          } else {
            item.classList.remove('expanded');
          }
          
          // به‌روزرسانی آیکون‌های feather
          setTimeout(function() {
            if (typeof feather !== 'undefined') {
              feather.replace();
            }
          }, 150);
        });
      });
    }
    
    // اجرا بعد از لود شدن صفحه
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLanguageCards);
    } else {
      initLanguageCards();
    }
  })();
</script>

{% endblock %}
